<?php

	require_once 'cOnfig/connection.php';
	require_once 'cOnfig/viewv6.php';
	require_once 'cOnfig/authenticate.php';
	require_once 'cOnfig/languages/common.php';
	

	session_start();
	$accessLevel = '3';
	
	// Authenticate & authorize
	authorizeUser($accessLevel);
	
	// $period = date('Y-m-02');
	$cycleDate = date('Y-10-02');
	$cycleDateView = date('02-10-Y');
	//$period = date('Y-m');
	$period = '202010';
	
	$query = "SELECT * FROM invoices WHERE invno IN ('S2000089', 'S2000286', 'S2000427', 'S2000617', 'S2000660', 'S2000820', 'S2000829', 'S2000834', 'S2000835', 'S2000874', 'S2001002', 'S2001045', 'S2001146', 'S2001182', 'S2001262', 'S2001276', 'S2001294', 'S2001333', 'S2001352', 'S2001381', 'S2001421', 'S2001446', 'S2001471', 'S2001472', 'S2001473', 'S2001475', 'S2001476', 'S2001478', 'S2001479', 'S2001480', 'S2001481', 'S2001482', 'S2001483', 'S2001484', 'S2001486', 'S2001488', 'S2001489', 'S2001490', 'S2001491', 'S2001492', 'S2001493', 'S2001494', 'S2001495', 'S2001496', 'S2001497', 'S2001501', 'S2001502', 'S2001504', 'S2001505', 'S2001506', 'S2001510', 'S2001511', 'S2001512', 'S2001513', 'S2001514', 'S2001515', 'S2001516', 'S2001517', 'S2001518', 'S2001519', 'S2001521', 'S2001522', 'S2001523', 'S2001525', 'S2001527', 'S2001528', 'S2001529', 'S2001530', 'S2001531', 'S2001532', 'S2001537', 'S2001538', 'S2001542', 'S2001547', 'S2001548', 'S2001549', 'S2001550', 'S2001551', 'S2001552', 'S2001554', 'S2001555', 'S2001556', 'S2001557', 'S2001558', 'S2001559', 'S2001560', 'S2001561', 'S2001562', 'S2001563', 'S2001564', 'S2001567', 'S2001568', 'S2001570', 'S2001571', 'S2001573', 'S2001575', 'S2001576', 'S2001577', 'S2001578', 'S2001579', 'S2001581', 'S2001582', 'S2001583', 'S2001584', 'S2001585', 'S2001586', 'S2001587', 'S2001588', 'S2001589', 'S2001590', 'S2001591', '2001594', 'S2001595', 'S2001596', 'S2001597', 'S2001598', 'S2001599', 'S2001600', 'S2001601', 'S2001602', 'S2001605', 'S2001607', 'S2001608', 'S2001609', 'S2001610', 'S2001612', 'S2001614', 'S2001615', 'S2001616', 'S2001617', 'S2001619', 'S2001620', 'S2001621', 'S2001624', 'S2001625', 'S2001626', 'S2001629', 'S2001630', 'S2001632', 'S2001634', 'S2001635', 'S2001636', 'S2001638', 'S2001639', 'S2001640', 'S2001641', 'S2001642', 'S2001643', 'S2001645', 'S2001646', 'S2001647', 'S2001648', 'S2001650', 'S2001651', 'S2001652', 'S2001654', 'S2001656', 'S2001657', 'S2001668', 'S2001669', 'S2001670', 'S2001690', 'S2001691', 'S2001692', 'S2001700') AND period = ''";
	try
	{
		$results = $pdo->prepare("$query");
		$results->execute();
	}
	catch (PDOException $e)
	{
			$error = 'Error fetching user: ' . $e->getMessage();
			echo $error;
			exit();
	}

	while ($row = $results->fetch()) {
		
		$invno = $row['invno'];
		$hash = generateRandomString(10);
		
		$query = "UPDATE invoices SET hash = '$hash', period = '$period' WHERE invno = '$invno'";
		try
		{
			$result = $pdo->prepare("$query")->execute();
		}
		catch (PDOException $e)
		{
				$error = 'Error fetching user: ' . $e->getMessage();
				echo $error;
				exit();
		}
		echo "$query<br />";
		
	}
	
	echo "FIN";
	exit();